# 第七章 安全优化



[TOC]

> 在服务端对系统进行保护



## 秒杀接口地址隐藏

思路：秒杀开始之前，先去请求接口获取秒杀地址（添加验证码保护获取秒杀地址的地址）

1. 接口改造，带上PathVariable参数
2. 添加生成地址的接口
3. 秒杀收到请求，先验证PathVariable



## 数学公式图形验证码（削峰，防止类似刷票机制恶意DOS攻击）

思路:点击秒杀之前，先输入验证码，分散用户的请求 错峰请求

1. 添加生成验证码的接口
2. 在获取秒杀路径的时候，验证验证码
3. ScriptEngine使用 JDK1.6添加

## 接口防刷 类似限流 （防止用户恶意用户多次点击）

- 思路：对接口做限流

> 将次数写入缓存中，给数据加入有效期，进入一次就给数据+1，限制数据的次数

- 进阶：

> 可以使用拦截器减少对业务的侵入
>
> 点击秒杀之后，首先是生成path，那假如我们对这个接口进行限制：5秒之内用户只能点击5次。
>
> 这放在redis中是非常好实现的，因为redis有个自增(自减)和缓存时间，可以很好地实现这个效果。
>
> 这里使用注解的方式来实现接口的限流防刷，使用注解的话就可以做成通用的方法，在你想使用限流防刷的接口就可以添加上该注解
>
> 假设，我想在5秒内最多请求5次，并且必须要登陆：相应的注解就是这样的：



代码进行两次重构，user参数获取重构 限流功能进行重构

martine flower 重构-改善现有代码的设计



